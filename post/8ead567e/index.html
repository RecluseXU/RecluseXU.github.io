

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="自娱自乐">
  <meta name="author" content="EvilRecluse">
  <meta name="keywords" content="">
  <title>MongoDB - EvilRecluse</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.6","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":true,"baidu":"https://hm.baidu.com/hm.js?758d4ab1e944598b8ead03bb4eb143a5","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Chaotic Record</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/md_editor/">
                <i class="iconfont icon-category-fill"></i>
                MDEditor
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="MongoDB">
              
            </span>

            
              <div class="mt-3">
  
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      5.7k 字
    </span>
  

  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MongoDB</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2021年6月8日 下午
                
              </p>
            
            <div class="markdown-body">
              <h1 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h1><p><code>MongoDB</code> 是一个由<code>C++</code>编的 写基于分布式文件存储的数据库。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案<br><code>MongoDB</code> 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的  </p>
<h2 id="存储"><a href="#存储" class="headerlink" title="存储"></a>存储</h2><p><code>MongoDB</code> 将数据存储为一个文档，数据结构由键值对组成<br><code>MongoDB</code> 文档类似于 <code>JSON</code> 对象。字段值可以包含其他文档，数组及文档数组  </p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li><code>MongoDB</code> 是一个面向文档存储的数据库，操作起来比较简单和容易  </li>
<li>MongoDB记录中设置任何属性的索引来实现更快的排序  </li>
<li>可以通过本地或者网络创建数据镜像，这使得MongoDB有更强的扩展性  </li>
<li>如果负载的增加 ，它可以分布在计算机网络中的其他节点上这就是所谓的分片  </li>
<li>Mongo支持丰富的查询表达式。查询指令使用JSON形式的标记，可轻易查询文档中内嵌的对象及数组  </li>
<li>使用update()命令可以实现替换完成的文档（数据）或者一些指定的数据字段  </li>
<li>Map和Reduce。Map函数调用emit(key,value)遍历集合中所有的记录，将key与value传给Reduce函数进行处理  </li>
<li>Map函数和Reduce函数是使用Javascript编写的，并可以通过db.runCommand或mapreduce命令来执行MapReduce操作  </li>
<li>GridFS是MongoDB中的一个内置功能，可以用于存放大量小文件  </li>
<li>MongoDB允许在服务端执行脚本，可以用Javascript编写某个函数，直接在服务端执行，也可以把函数的定义存储在服务端，下次直接调用  </li>
</ul>
<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><p>官网：<a target="_blank" rel="noopener" href="https://www.mongodb.com/">https://www.mongodb.com/</a>  </p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h2><h3 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h3><figure class="highlight ebnf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker pull mongo</span><br></code></pre></div></td></tr></table></figure>
<p>如果想要安装非最新版，可以查询<a target="_blank" rel="noopener" href="https://hub.docker.com/_/mongo?tab=tags&page=1">Docker镜像信息</a>信息<br>或者使用<code>docker search mongo</code>来查看可用版本    </p>
<p>在拉取完毕后，可以使用<code>docker images</code>来查看镜像信息</p>
<h3 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h3><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -itd --name mongo -p <span class="hljs-number">27018</span>:<span class="hljs-number">27017</span> mongo --auth<br></code></pre></div></td></tr></table></figure>
<p>參數説明：  </p>
<ul>
<li>-p 27018:27017<br>映射容器服务的<code>27017</code>端口到宿主机的<code>27018</code>端口。外部可以直接通过<code>ip:27018</code> 访问到<code>mongo</code>的服务</li>
<li>–auth<br>需要密码才能访问容器服务  </li>
<li>-itd<br>实际上是<code>-i</code> <code>-t</code> <code>-d</code>的简写  <ul>
<li><code>-i</code> 以交互模式运行容器，通常与 <code>-t</code> 同时使用  </li>
<li><code>-t</code>    为容器重新分配一个伪输入终端，通常与 <code>-i</code> 同时使用  </li>
<li><code>-d</code>    后台运行容器，并返回容器ID  </li>
</ul>
</li>
</ul>
<p>可以通过<code>docker ps</code>命令查看容器的运行信息  </p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><h4 id="进入容器控制台"><a href="#进入容器控制台" class="headerlink" title="进入容器控制台"></a>进入容器控制台</h4><figure class="highlight sqf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sqf">docker <span class="hljs-built_in">exec</span> -it mongo mongo <span class="hljs-built_in">admin</span><br></code></pre></div></td></tr></table></figure>
<h4 id="创建一个超级账户"><a href="#创建一个超级账户" class="headerlink" title="创建一个超级账户"></a>创建一个超级账户</h4><figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.createUser</span>(&#123; <span class="hljs-attribute">user</span>:<span class="hljs-string">&#x27;用户名&#x27;</span>,<span class="hljs-attribute">pwd</span>:<span class="hljs-string">&#x27;密码&#x27;</span>,<span class="hljs-attribute">roles</span>:[ &#123; <span class="hljs-attribute">role</span>:<span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-attribute">db</span>: <span class="hljs-string">&#x27;admin&#x27;</span>&#125;]&#125;);<br></code></pre></div></td></tr></table></figure>
<p>在创建完用户以后尝试使用新用户进行连接  </p>
<figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.auth</span>(<span class="hljs-string">&#x27;用户名&#x27;</span>, <span class="hljs-string">&#x27;密码&#x27;</span>)<br></code></pre></div></td></tr></table></figure>
<p>如果正确可行的话，会返回1，这也意味着账户切换成功  </p>
<h3 id="其它创建账户"><a href="#其它创建账户" class="headerlink" title="其它创建账户"></a>其它创建账户</h3><figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.createUser</span>(&#123;<span class="hljs-attribute">user</span>: <span class="hljs-string">&quot;账户名&quot;</span>, <span class="hljs-attribute">pwd</span>: <span class="hljs-string">&quot;密码&quot;</span>, <span class="hljs-attribute">roles</span>: [&#123; <span class="hljs-attribute">role</span>: <span class="hljs-string">&quot;角色类型&quot;</span>, <span class="hljs-attribute">db</span>: <span class="hljs-string">&quot;数据库名称&quot;</span> &#125;]&#125;)   <br></code></pre></div></td></tr></table></figure>
<p>可用角色类型：</p>
<ul>
<li>数据库用户角色（Database User Roles）  <ul>
<li>read：授予User只读数据的权限  </li>
<li>readWrite：授予User读写数据的权限  </li>
</ul>
</li>
<li>数据库管理角色（Database Administration Roles）  <ul>
<li>dbAdmin：在当前dB中执行管理操作  </li>
<li>dbOwner：在当前DB中执行任意操作  </li>
<li>userAdmin：在当前DB中管理User  </li>
</ul>
</li>
<li>备份和还原角色（Backup and Restoration Roles）  <ul>
<li>backup  </li>
<li>restore  </li>
</ul>
</li>
<li>跨库角色（All-Database Roles）  <ul>
<li>readAnyDatabase：授予在所有数据库上读取数据的权限  </li>
<li>readWriteAnyDatabase：授予在所有数据库上读写数据的权限  </li>
<li>userAdminAnyDatabase：授予在所有数据库上管理User的权限  </li>
<li>dbAdminAnyDatabase：授予管理所有数据库的权限  </li>
</ul>
</li>
</ul>
<h1 id="MongoDB名词概念"><a href="#MongoDB名词概念" class="headerlink" title="MongoDB名词概念"></a>MongoDB名词概念</h1><table>
<thead>
<tr>
<th>SQL术语/概念</th>
<th>MongoDB术语/概念</th>
</tr>
</thead>
<tbody><tr>
<td>database 数据库</td>
<td>database 数据库</td>
</tr>
<tr>
<td>table     数据库表</td>
<td>collection 集合</td>
</tr>
<tr>
<td>row     数据记录行</td>
<td>document 文档</td>
</tr>
<tr>
<td>column     数据字段</td>
<td>field    域</td>
</tr>
<tr>
<td>index   索引</td>
<td>index 索引</td>
</tr>
<tr>
<td>table joins表连接</td>
<td>不支持</td>
</tr>
<tr>
<td>primary key 主键</td>
<td>primary key     MongoDB自动将_id字段设置为主键</td>
</tr>
</tbody></table>
<p><img src="/MongoDB/20200911074758467.png" srcset="/img/loading.gif">  </p>
<h1 id="数据库-database"><a href="#数据库-database" class="headerlink" title="数据库 database"></a>数据库 database</h1><p>一个<code>mongodb</code>中可以建立多个数据库<br><code>MongoDB</code>的默认数据库为”db”，该数据库存储在data目录中<br><code>MongoDB</code>的单个实例可以容纳多个独立的数据库，每一个都有自己的集合和权限，不同的数据库也放置在不同的文件中  </p>
<h2 id="数据库命名"><a href="#数据库命名" class="headerlink" title="数据库命名"></a>数据库命名</h2><p>数据库名为utf-8字符串,符合以下标准：  </p>
<ul>
<li>非空  </li>
<li>不含（空格)、.、$、/、\和\0 (空字符)  </li>
<li>字母全部小写  </li>
<li>小于64字节  </li>
</ul>
<h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><table>
<thead>
<tr>
<th>命令</th>
<th>信息</th>
</tr>
</thead>
<tbody><tr>
<td><code>show dbs</code></td>
<td>查询所有含有文档的数据库信息</td>
</tr>
<tr>
<td><code>db</code></td>
<td>显示当前数据库信息</td>
</tr>
<tr>
<td><code>use 数据库名</code></td>
<td>连接到指定数据库</br>如果数据库不存在则创建数据库</td>
</tr>
<tr>
<td><code>db.dropDatabase()</code></td>
<td>删除当前数据库</td>
</tr>
</tbody></table>
<h2 id="保留的数据库"><a href="#保留的数据库" class="headerlink" title="保留的数据库"></a>保留的数据库</h2><p>有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库。</p>
<table>
<thead>
<tr>
<th>保留数据库名</th>
<th>信息</th>
</tr>
</thead>
<tbody><tr>
<td>admin</td>
<td>从权限的角度来看，这是”root”数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器</td>
</tr>
<tr>
<td>local</td>
<td>这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合</td>
</tr>
<tr>
<td>config</td>
<td>当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息</td>
</tr>
</tbody></table>
<h1 id="集合-Collection"><a href="#集合-Collection" class="headerlink" title="集合 Collection"></a>集合 Collection</h1><h2 id="常用操作-1"><a href="#常用操作-1" class="headerlink" title="常用操作"></a>常用操作</h2><h3 id="创建集合"><a href="#创建集合" class="headerlink" title="创建集合"></a>创建集合</h3><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">db.create<span class="hljs-constructor">Collection(<span class="hljs-params">name</span>, <span class="hljs-params">options</span>)</span><br></code></pre></div></td></tr></table></figure>
<ul>
<li><p>name：集合名</p>
</li>
<li><p>option：可选参数</p>
<ul>
<li><p>capped（bool)<br> 如果为 true，则创建固定集合。为 true 时，必须指定 size 参数  </p>
<blockquote>
<p>固定集合是指有着固定大小的集合，当达到最大值时，它会自动覆盖最早的文档  </p>
</blockquote>
</li>
<li><p>size (int)<br> 为固定集合指定一个最大值，即字节数<br> 如果 capped 为 true，也需要指定该字段  </p>
</li>
<li><p>max (int)<br> 指定固定集合中包含文档的最大数量  </p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>案例: 创建集合  </p>
</blockquote>
<figure class="highlight stata"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stata"><span class="hljs-keyword">use</span> <span class="hljs-keyword">test</span><br>&gt;&gt;&gt;switched to <span class="hljs-keyword">db</span> <span class="hljs-keyword">test</span><br><span class="hljs-keyword">db</span>.createCollection(<span class="hljs-string">&quot;runoob&quot;</span>)<br>&gt;&gt;&gt;&#123; <span class="hljs-string">&quot;ok&quot;</span> : 1 &#125;<br></code></pre></div></td></tr></table></figure>


<h3 id="查看集合"><a href="#查看集合" class="headerlink" title="查看集合"></a>查看集合</h3><p>命令有两个，随便一个都可以  </p>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">show</span> collections<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span><br></code></pre></div></td></tr></table></figure>
<h3 id="删除集合"><a href="#删除集合" class="headerlink" title="删除集合"></a>删除集合</h3><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.collection</span><span class="hljs-selector-class">.drop</span>()<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>案例: 删除集合  </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">use mydb<br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt;switched to db mydb</span><br><br>show collections<br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt;mycol</span><br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt;mycol2</span><br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt;system.indexes</span><br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt;runoob</span><br><br>show collections<br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt;mycol</span><br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt;system.indexes</span><br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt;runoob</span><br></code></pre></div></td></tr></table></figure>

<h1 id="文档-Document"><a href="#文档-Document" class="headerlink" title="文档 Document"></a>文档 Document</h1><p>文档的数据结构和 JSON 基本一样<br>所有存储在集合中的数据都是 <code>BSON</code> 格式<br><code>BSON</code> 是一种类似 JSON 的二进制形式的存储格式，是 <code>Binary JSON</code> 的简称  </p>
<ul>
<li>文档不需要设置相同的字段，相同的字段不需要相同的数据类型   </li>
<li>文档中的键/值对是有序的    </li>
<li>文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)  </li>
<li>区分类型和大小写  </li>
<li>文档不能有重复的键  </li>
<li>文档的键是字符串。除了少数例外情况，键可以使用任意<code>UTF-8</code>字符  </li>
</ul>
<h2 id="文档键命名规范"><a href="#文档键命名规范" class="headerlink" title="文档键命名规范"></a>文档键命名规范</h2><ul>
<li>键不能含有\0 (空字符)。这个字符用来表示键的结尾  </li>
<li>用<code>.</code>分层  </li>
<li>$有特别的意义，只有在特定环境下才能使用  </li>
<li>以下划线<code>_</code>开头的键是保留的(不是严格要求的)  </li>
</ul>
<h2 id="常用操作-2"><a href="#常用操作-2" class="headerlink" title="常用操作"></a>常用操作</h2><h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><h4 id="db-collection-insertOne"><a href="#db-collection-insertOne" class="headerlink" title="db.collection.insertOne"></a>db.collection.insertOne</h4><p>作用：如果主键存在则更新数据，如果不存在就插入数据  </p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.collection</span><span class="hljs-selector-class">.insertOne</span>(<br>   &lt;<span class="hljs-selector-tag">document</span>&gt;,<br>   &#123;<br>      <span class="hljs-attribute">writeConcern</span>: &lt;document&gt;<br>   &#125;<br>)<br></code></pre></div></td></tr></table></figure>
<ul>
<li>document：要写入的文档  </li>
<li>writeConcern：写入策略，默认为 1，即要求确认写操作，0 是不要求  </li>
<li>ordered：指定是否按顺序写入，默认 true，按顺序写入  </li>
</ul>
<blockquote>
<p>案例: 插入文档   </p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.products</span><span class="hljs-selector-class">.insertOne</span>( &#123; <span class="hljs-attribute">item</span>: <span class="hljs-string">&quot;card&quot;</span>, qty: <span class="hljs-number">15</span> &#125; );<br></code></pre></div></td></tr></table></figure>

<h4 id="db-collection-insertMany"><a href="#db-collection-insertMany" class="headerlink" title="db.collection.insertMany"></a>db.collection.insertMany</h4><p>作用：向集合插入一个多个文档  </p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.collection</span><span class="hljs-selector-class">.insertMany</span>(<br>   <span class="hljs-selector-attr">[ &lt;document 1&gt; , &lt;document 2&gt;, ... ]</span>,<br>   &#123;<br>      <span class="hljs-attribute">writeConcern</span>: &lt;document&gt;,<br>      ordered: &lt;boolean&gt;<br>   &#125;<br>)<br></code></pre></div></td></tr></table></figure>
<p>参数与<code>db.collection.insertOne</code>一致  </p>
<blockquote>
<p>案例  往 products集合 插入一些数据  </p>
</blockquote>
<figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.products</span><span class="hljs-selector-class">.insertMany</span>( [<br>  &#123; <span class="hljs-attribute">item</span>: <span class="hljs-string">&quot;card&quot;</span>, <span class="hljs-attribute">qty</span>: <span class="hljs-number">15</span> &#125;,<br>  &#123; <span class="hljs-attribute">item</span>: <span class="hljs-string">&quot;envelope&quot;</span>, <span class="hljs-attribute">qty</span>: <span class="hljs-number">20</span> &#125;,<br>  &#123; <span class="hljs-attribute">item</span>: <span class="hljs-string">&quot;stamps&quot;</span> , <span class="hljs-attribute">qty</span>: <span class="hljs-number">30</span> &#125;<br>   ] );<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h4 id="db-collection-insert"><a href="#db-collection-insert" class="headerlink" title="db.collection.insert()"></a>db.collection.insert()</h4><p>若插入的数据主键已经存在，则会抛<code>org.springframework.dao.DuplicateKeyException</code> 异常，提示主键重复，不保存当前数据  </p>
<blockquote>
<p>案例：向 runoob 数据库 的 col 集合中插入数据  </p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.col</span><span class="hljs-selector-class">.insert</span>(&#123;<span class="hljs-attribute">title</span>: <span class="hljs-string">&#x27;MongoDB 教程&#x27;</span>, <br>   description: <span class="hljs-string">&#x27;MongoDB 是一个 Nosql 数据库&#x27;</span>,<br>   by: <span class="hljs-string">&#x27;菜鸟教程&#x27;</span>,<br>   url: <span class="hljs-string">&#x27;http://www.runoob.com&#x27;</span>,<br>   tags: [<span class="hljs-string">&#x27;mongodb&#x27;</span>, <span class="hljs-string">&#x27;database&#x27;</span>, <span class="hljs-string">&#x27;NoSQL&#x27;</span>],<br>   likes: <span class="hljs-number">100</span><br>&#125;)<br></code></pre></div></td></tr></table></figure>
</blockquote>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.deleteOne/">db.collection.deleteOne</a><br>删除集合中的一个文档    </p>
<figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts">db.collection.deleteOne(<br>   <span class="hljs-params">&lt;filter&gt;</span>,<br>   &#123;<br><span class="hljs-symbol">      writeConcern:</span> <span class="hljs-params">&lt;document&gt;</span>,<br><span class="hljs-symbol">      collation:</span> <span class="hljs-params">&lt;document&gt;</span>,<br><span class="hljs-symbol">      hint:</span> <span class="hljs-params">&lt;document|string&gt;</span>    <span class="hljs-comment">// Available starting in MongoDB 4.4</span><br>   &#125;<br>)<br></code></pre></div></td></tr></table></figure>
<ul>
<li>filter<br>指定删除条件,如果设置为{}则删除第一个文档  </li>
<li>writeConcern<br>可选参数，写入关注，其值为一个文档  </li>
<li>collation<br>可选参数，指定用于操作的集合  </li>
<li>hint<br>可选参数，指定用于支持查询谓词的索引的文档或字符串  </li>
</ul>
<blockquote>
<p>假设现在有一个order集合，集合中有这么个文档  </p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css">&#123;<br>   <span class="hljs-attribute">_id</span>: <span class="hljs-built_in">ObjectId</span>(<span class="hljs-string">&quot;563237a41a4d68582c2509da&quot;</span>),<br>   stock: <span class="hljs-string">&quot;Brent Crude Futures&quot;</span>,<br>   qty: <span class="hljs-number">250</span>,<br>   type: <span class="hljs-string">&quot;buy-limit&quot;</span>,<br>   limit: <span class="hljs-number">48.90</span>,<br>   creationts: <span class="hljs-built_in">ISODate</span>(<span class="hljs-string">&quot;2015-11-01T12:30:15Z&quot;</span>),<br>   expiryts: <span class="hljs-built_in">ISODate</span>(<span class="hljs-string">&quot;2015-11-01T12:35:15Z&quot;</span>),<br>   client: <span class="hljs-string">&quot;Crude Traders Inc.&quot;</span><br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>案例： 根据删除<code>_id</code>为<code>233</code>的文档  </p>
<figure class="highlight ada"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ada">db.orders.deleteOne( &#123; <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-type">ObjectId</span>(<span class="hljs-string">&quot;233&quot;</span>) &#125; );<br></code></pre></div></td></tr></table></figure></blockquote>
</li>
<li><p>db.collection.deleteMany<br>删除集合中所有符合<code>filter</code>的文档<br><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.collection.deleteMany/">文档地址</a>  </p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.collection</span><span class="hljs-selector-class">.deleteMany</span>(<br>   &lt;<span class="hljs-selector-tag">filter</span>&gt;,<br>   &#123;<br>      <span class="hljs-attribute">writeConcern</span>: &lt;document&gt;,<br>      collation: &lt;document&gt;<br>   &#125;<br>)<br></code></pre></div></td></tr></table></figure>
<p>  参数同<code>db.collection.deleteOne</code>  </p>
<blockquote>
<p>案例<br>假设现在有一个order集合，集合中有这么个文档  </p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css">&#123;<br>  <span class="hljs-attribute">_id</span>: <span class="hljs-built_in">ObjectId</span>(<span class="hljs-string">&quot;563237a41a4d68582c2509da&quot;</span>),<br>  stock: <span class="hljs-string">&quot;Brent Crude Futures&quot;</span>,<br>  client: <span class="hljs-string">&quot;Crude Traders Inc.&quot;</span><br>&#125;<br>&#123;<br>  <span class="hljs-attribute">_id</span>: <span class="hljs-built_in">ObjectId</span>(<span class="hljs-string">&quot;123437a41a423423444509da&quot;</span>),<br>  stock: <span class="hljs-string">&quot;Brent Crude Futures&quot;</span>,<br>  client: <span class="hljs-string">&quot;Crude Traders Inc.&quot;</span><br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>案例： 根据删除<code>client</code>为<code>Crude Traders Inc.</code>的文档  </p>
<figure class="highlight mipsasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mipsasm">db.<span class="hljs-keyword">orders.deleteMany( </span>&#123; <span class="hljs-string">&quot;client&quot;</span> : <span class="hljs-string">&quot;Crude Traders Inc.&quot;</span> &#125; );<br></code></pre></div></td></tr></table></figure>
</blockquote>
<h3 id="更改"><a href="#更改" class="headerlink" title="更改"></a>更改</h3><h4 id="db-collection-update"><a href="#db-collection-update" class="headerlink" title="db.collection.update"></a>db.collection.update</h4><p>作用：更新已存在的文档  </p>
</li>
</ul>
<p>使用格式</p>
<figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts">db.collection.update(<br>   <span class="hljs-params">&lt;query&gt;</span>,<br>   <span class="hljs-params">&lt;update&gt;</span>,<br>   &#123;<br><span class="hljs-symbol">     upsert:</span> <span class="hljs-params">&lt;boolean&gt;</span>,<br><span class="hljs-symbol">     multi:</span> <span class="hljs-params">&lt;boolean&gt;</span>,<br><span class="hljs-symbol">     writeConcern:</span> <span class="hljs-params">&lt;document&gt;</span><br>   &#125;<br>)<br></code></pre></div></td></tr></table></figure>
<ul>
<li>query : update的查询条件，类似sql update查询内where后面的  </li>
<li>update : update的对象和一些更新的操作符（如$,$inc…）等，也可以理解为sql update查询内set后面的  </li>
<li>upsert : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入  </li>
<li>multi : 可选，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新  </li>
<li>writeConcern :可选，抛出异常的级别  </li>
</ul>
<blockquote>
<p>案例：更改<code>title</code>为<code>mysql</code>  </p>
</blockquote>
<p>假设现在有一个order集合，集合中有这么个文档  </p>
<figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;_id&quot;</span> : ObjectId(<span class="hljs-string">&quot;1&quot;</span>),<br>    <span class="hljs-attr">&quot;title&quot;</span> : <span class="hljs-string">&quot;MongoDB&quot;</span>,<br>    <span class="hljs-attr">&quot;description&quot;</span> : <span class="hljs-string">&quot;MongoDB 是一个 Nosql 数据库&quot;</span>,<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>更改<code>title</code>为<code>mysql</code>  </p>
<figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim">db.<span class="hljs-keyword">col</span>.<span class="hljs-keyword">update</span>(&#123;<span class="hljs-string">&#x27;title&#x27;</span>:<span class="hljs-string">&#x27;MongoDB&#x27;</span>&#125;,&#123;$<span class="hljs-keyword">se</span><span class="hljs-variable">t:</span>&#123;<span class="hljs-string">&#x27;title&#x27;</span>:<span class="hljs-string">&#x27;mysql&#x27;</span>&#125;&#125;)<br></code></pre></div></td></tr></table></figure>
<p>需要注意的是，这语句只会修改第一个发现的文档<br>如果想要修改多个，需要添加 <code>&#123;multi:true&#125;</code></p>
<figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim">db.<span class="hljs-keyword">col</span>.<span class="hljs-keyword">update</span>(&#123;<span class="hljs-string">&#x27;title&#x27;</span>:<span class="hljs-string">&#x27;MongoDB&#x27;</span>&#125;,&#123;$<span class="hljs-keyword">se</span><span class="hljs-variable">t:</span>&#123;<span class="hljs-string">&#x27;title&#x27;</span>:<span class="hljs-string">&#x27;mysqls&#x27;</span>&#125;&#125;,&#123;multi:true&#125;)<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>官方文档説明：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/reference/command/update/">https://docs.mongodb.com/master/reference/command/update/</a>  </p>
</blockquote>
<h4 id="db-collection-save"><a href="#db-collection-save" class="headerlink" title="db.collection.save"></a>db.collection.save</h4><p>作用：通过传入的文档来替换已有文档，主键存在就更新，不存在就插入  </p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.collection</span><span class="hljs-selector-class">.save</span>(<br>   &lt;<span class="hljs-selector-tag">document</span>&gt;,<br>   &#123;<br>     <span class="hljs-attribute">writeConcern</span>: &lt;document&gt;<br>   &#125;<br>)<br></code></pre></div></td></tr></table></figure>
<ul>
<li>document : 文档数据  </li>
<li>writeConcern :可选，抛出异常的级别  </li>
</ul>
<p>实际上就是用一个新的文档来覆盖旧的,关键是要让_id主键一致    </p>
<figure class="highlight maxima"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs maxima">db.<span class="hljs-built_in">col</span>.<span class="hljs-built_in">save</span>(&#123;<br>    <span class="hljs-string">&quot;_id&quot;</span> : ObjectId(<span class="hljs-string">&quot;1&quot;</span>),<br>    <span class="hljs-string">&quot;title&quot;</span> : <span class="hljs-string">&quot;MongoDB&quot;</span>,<br>&#125;)<br></code></pre></div></td></tr></table></figure>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><h4 id="db-collection-find"><a href="#db-collection-find" class="headerlink" title="db.collection.find"></a>db.collection.find</h4><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.collection</span><span class="hljs-selector-class">.find</span>(<span class="hljs-selector-tag">query</span>, <span class="hljs-selector-tag">projection</span>)<br></code></pre></div></td></tr></table></figure>
<ul>
<li>query ：可选，使用查询操作符指定查询条件  </li>
<li>projection ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可（默认省略）  </li>
</ul>
<p>如果你希望返回比较好看的形式，可以用<code>pretty</code>  </p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.col</span><span class="hljs-selector-class">.find</span>()<span class="hljs-selector-class">.pretty</span>()<br></code></pre></div></td></tr></table></figure>
<p>实际上还有一个 <code>findOne</code> 方法专门用来找单个文档    </p>
<h4 id="限制查询数量-Limit"><a href="#限制查询数量-Limit" class="headerlink" title="限制查询数量 Limit"></a>限制查询数量 Limit</h4><p>如果你需要在<code>MongoDB</code>中读取指定数量的数据记录，可以使用<code>MongoDB</code>的<code>Limit</code>方法<br><code>limit()</code>方法接受一个数字参数，该参数指定从MongoDB中读取的记录条数<br>未指定<code>limit</code>方法中的参数则显示集合中的所有数据  </p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.COLLECTION_NAME</span><span class="hljs-selector-class">.find</span>()<span class="hljs-selector-class">.limit</span>(<span class="hljs-selector-tag">NUMBER</span>)<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>案例：查找前两条数据</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">db</span>.col.find(&#123;&#125;,&#123;<span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-number">1</span>,_id:<span class="hljs-number">0</span>&#125;).limit(<span class="hljs-number">2</span>)<br></code></pre></div></td></tr></table></figure>

<h4 id="跳过查询数量-Skip"><a href="#跳过查询数量-Skip" class="headerlink" title="跳过查询数量 Skip()"></a>跳过查询数量 Skip()</h4><p>除了可以使用<code>limit</code>方法来读取指定数量的数据外，还可以使用<code>skip</code>方法来跳过指定数量的数据<br>skip方法同样接受一个数字参数作为跳过的记录条数。默认参数为 0   </p>
<blockquote>
<p>案例：查找第二条数据</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.COLLECTION_NAME</span><span class="hljs-selector-class">.find</span>()<span class="hljs-selector-class">.limit</span>(<span class="hljs-selector-tag">NUMBER</span>)<span class="hljs-selector-class">.skip</span>(<span class="hljs-selector-tag">NUMBER</span>)<br></code></pre></div></td></tr></table></figure>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">db</span>.col.find(&#123;&#125;,&#123;<span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-number">1</span>,_id:<span class="hljs-number">0</span>&#125;).limit(<span class="hljs-number">1</span>).skip(<span class="hljs-number">1</span>)<br></code></pre></div></td></tr></table></figure>
<h4 id="排序-sort"><a href="#排序-sort" class="headerlink" title="排序 sort()"></a>排序 sort()</h4><p><code>sort</code> 方法可以通过参数指定排序的字段，并使用 1 和 -1 来指定排序的方式<br>1 为升序排列，而 -1 是用于降序排列  </p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.COLLECTION_NAME</span><span class="hljs-selector-class">.find</span>()<span class="hljs-selector-class">.sort</span>(&#123;<span class="hljs-attribute">KEY</span>:<span class="hljs-number">1</span>&#125;)<br></code></pre></div></td></tr></table></figure>
<h1 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h1><h2 id="比较逻辑"><a href="#比较逻辑" class="headerlink" title="比较逻辑"></a>比较逻辑</h2><table>
<thead>
<tr>
<th>操作</th>
<th>格式</th>
<th>范例</th>
<th>RDBMS中的类似语句</th>
</tr>
</thead>
<tbody><tr>
<td>等于</td>
<td>{<code>&lt;key&gt;</code>:<code>&lt;value&gt;</code>}</td>
<td>db.col.find({“by”:”123”}).pretty()</td>
<td>where by = ‘123’</td>
</tr>
<tr>
<td>小于</td>
<td>{<code>&lt;key&gt;</code>:{$lt:<code>&lt;value&gt;</code>}}</td>
<td>db.col.find({“likes”:{$lt:50}}).pretty()</td>
<td>where likes &lt; 50</td>
</tr>
<tr>
<td>小于或等于</td>
<td>{<code>&lt;key&gt;</code>:{$lte:<code>&lt;value&gt;</code>}}</td>
<td>db.col.find({“likes”:{$lte:50}}).pretty()</td>
<td>where likes &lt;= 50</td>
</tr>
<tr>
<td>大于</td>
<td>{<code>&lt;key&gt;</code>:{$gt:<code>&lt;value&gt;</code>}}</td>
<td>db.col.find({“likes”:{$gt:50}}).pretty()</td>
<td>where likes &gt; 50</td>
</tr>
<tr>
<td>大于或等于</td>
<td>{<code>&lt;key&gt;</code>:{$gte:<code>&lt;value&gt;</code>}}</td>
<td>db.col.find({“likes”:{$gte:50}}).pretty()</td>
<td>where likes &gt;= 50</td>
</tr>
<tr>
<td>不等于</td>
<td>{<code>&lt;key&gt;</code>:{$ne:<code>&lt;value&gt;</code>}}</td>
<td>db.col.find({“likes”:{$ne:50}}).pretty()</td>
<td>where likes != 50</td>
</tr>
</tbody></table>
<h2 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h2><h3 id="and-与逻辑"><a href="#and-与逻辑" class="headerlink" title="and 与逻辑"></a>and 与逻辑</h3><p>同时传入多个键即可  </p>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">db</span>.col.find(&#123;key<span class="hljs-number">1</span>:value<span class="hljs-number">1</span>, key<span class="hljs-number">2</span>:value<span class="hljs-number">2</span>&#125;).pretty()<br></code></pre></div></td></tr></table></figure>
<h3 id="or-或逻辑"><a href="#or-或逻辑" class="headerlink" title="or 或逻辑"></a>or 或逻辑</h3><p>使用关键词<code>$or</code>  </p>
<figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.col</span><span class="hljs-selector-class">.find</span>(&#123;<br>    $<span class="hljs-attribute">or</span>: [&#123;<span class="hljs-attribute">key1</span>: value1&#125;, &#123;<span class="hljs-attribute">key2</span>:value2&#125;] <br>&#125;)<span class="hljs-selector-class">.pretty</span>()<br></code></pre></div></td></tr></table></figure>
<h3 id="not-非逻辑"><a href="#not-非逻辑" class="headerlink" title="not 非逻辑"></a>not 非逻辑</h3><p>使用关键词<code>$not</code>  </p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.col</span><span class="hljs-selector-class">.find</span>(<br>    &#123; <span class="hljs-attribute">key</span>: &#123; $not: &#123; $gt: value &#125; &#125; &#125; <br>)<br></code></pre></div></td></tr></table></figure>
<h3 id="type-操作符"><a href="#type-操作符" class="headerlink" title="$type 操作符"></a><code>$type</code> 操作符</h3><p><code>$type</code>操作符是基于<code>BSON</code>类型来检索集合中匹配的数据类型，并返回结果   </p>
<table>
<thead>
<tr>
<th>类型</th>
<th>数字</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>Double</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>String</td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>Object</td>
<td>3</td>
<td></td>
</tr>
<tr>
<td>Array</td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>Binary data</td>
<td>5</td>
<td></td>
</tr>
<tr>
<td>Undefined</td>
<td>6</td>
<td>已废弃</td>
</tr>
<tr>
<td>Object id</td>
<td>7</td>
<td></td>
</tr>
<tr>
<td>Boolean</td>
<td>8</td>
<td></td>
</tr>
<tr>
<td>Date</td>
<td>9</td>
<td></td>
</tr>
<tr>
<td>Null</td>
<td>10</td>
<td></td>
</tr>
<tr>
<td>Regular Expression</td>
<td>11</td>
<td></td>
</tr>
<tr>
<td>JavaScript</td>
<td>13</td>
<td></td>
</tr>
<tr>
<td>Symbol</td>
<td>14</td>
<td></td>
</tr>
<tr>
<td>JavaScript (with scope)</td>
<td>15</td>
<td></td>
</tr>
<tr>
<td>32-bit integer</td>
<td>16</td>
<td></td>
</tr>
<tr>
<td>Timestamp</td>
<td>17</td>
<td></td>
</tr>
<tr>
<td>64-bit integer</td>
<td>18</td>
<td></td>
</tr>
<tr>
<td>Min key</td>
<td>255</td>
<td>Query with -1</td>
</tr>
<tr>
<td>Max key</td>
<td>127</td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>案例：寻找标题为字符串类型的文档  </p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">db.col.<span class="hljs-builtin-name">find</span>(&#123;<span class="hljs-string">&quot;title&quot;</span> : &#123;<span class="hljs-variable">$type</span> : 2&#125;&#125;)<br>db.col.<span class="hljs-builtin-name">find</span>(&#123;<span class="hljs-string">&quot;title&quot;</span> : &#123;<span class="hljs-variable">$type</span> : <span class="hljs-string">&#x27;string&#x27;</span>&#125;&#125;)<br></code></pre></div></td></tr></table></figure>

<h2 id="多集合查询"><a href="#多集合查询" class="headerlink" title="多集合查询"></a>多集合查询</h2><p>实际上，多集合查询是利用聚合的 <code>$lookup</code>多表关联 实现的<br>具体见后</p>
<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p>索引通常能够极大的提高查询的效率<br>索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构  </p>
<blockquote>
<p>如果没有索引，MongoDB在读取数据时必须扫描集合中的每个文件并选取那些符合查询条件的记录。这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非常致命的  </p>
</blockquote>
<h2 id="常用操作-3"><a href="#常用操作-3" class="headerlink" title="常用操作"></a>常用操作</h2><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">db.collection.create<span class="hljs-constructor">Index(<span class="hljs-params">keys</span>, <span class="hljs-params">options</span>)</span><br></code></pre></div></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>值类型</th>
<th>信息</th>
</tr>
</thead>
<tbody><tr>
<td>background</td>
<td>Boolean</td>
<td>建索引过程会阻塞其它数据库操作，background可指定以后台方式创建索引，即增加 “background” 可选参数。 “background” 默认值为false。</td>
</tr>
<tr>
<td>unique</td>
<td>Boolean</td>
<td>建立的索引是否唯一。指定为true创建唯一索引。默认值为false.</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>索引的名称。如果未指定，MongoDB的通过连接索引的字段名和排序顺序生成一个索引名称。</td>
</tr>
<tr>
<td>dropDups</td>
<td>Boolean</td>
<td>3.0+版本已废弃。在建立唯一索引时是否删除重复记录,指定 true 创建唯一索引。默认值为 false.</td>
</tr>
<tr>
<td>sparse</td>
<td>Boolean</td>
<td>对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为true的话，在索引字段中不会查询出不包含对应字段的文档.。默认值为 false.</td>
</tr>
<tr>
<td>expireAfterSeconds</td>
<td>integer</td>
<td>指定一个以秒为单位的数值，完成 TTL设定，设定集合的生存时间。</td>
</tr>
<tr>
<td>v</td>
<td>index version</td>
<td>索引的版本号。默认的索引版本取决于mongod创建索引时运行的版本。</td>
</tr>
<tr>
<td>weights</td>
<td>document</td>
<td>索引权重值，数值在 1 到 99,999 之间，表示该索引相对于其他索引字段的得分权重。</td>
</tr>
<tr>
<td>default_language</td>
<td>string</td>
<td>对于文本索引，该参数决定了停用词及词干和词器的规则的列表。 默认为英语</td>
</tr>
<tr>
<td>language_override</td>
<td>string</td>
<td>对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的language，默认值为 language.</td>
</tr>
</tbody></table>
<blockquote>
<p>案例：以<code>title</code>键建立索引  </p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">db</span>.col.createIndex(&#123;<span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-number">1</span>&#125;)<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>案例：以<code>title</code>与<code>name</code>键在后台建立索引  </p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.values</span><span class="hljs-selector-class">.createIndex</span>(&#123;<span class="hljs-attribute">title</span>: <span class="hljs-number">1</span>, name: <span class="hljs-number">1</span>&#125;, &#123;<span class="hljs-attribute">background</span>: true&#125;)<br></code></pre></div></td></tr></table></figure>
<p>通过在创建索引时加 <code>background:true</code> 的选项，让创建工作在后台执行</p>
<h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h3><ul>
<li>查看集合索引  <figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.col</span><span class="hljs-selector-class">.getIndexes</span>()<br></code></pre></div></td></tr></table></figure></li>
<li>查看集合索引大小  <figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.col</span><span class="hljs-selector-class">.totalIndexSize</span>()<br></code></pre></div></td></tr></table></figure>
<h3 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h3></li>
<li>删除集合所有索引  <figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.col</span><span class="hljs-selector-class">.dropIndexes</span>()<br></code></pre></div></td></tr></table></figure></li>
<li>删除集合指定索引  <figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.col</span><span class="hljs-selector-class">.dropIndex</span>(&quot;索引名称&quot;)<br></code></pre></div></td></tr></table></figure>


</li>
</ul>
<h2 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h2><p><code>MongoDB</code>中聚合(aggregate)主要用于处理数据(诸如统计平均值,求和等)，并返回计算后的数据结果  </p>
<h3 id="aggregate-方法"><a href="#aggregate-方法" class="headerlink" title="aggregate() 方法"></a>aggregate() 方法</h3><p>MongoDB中聚合的方法使用 <code>aggregate()</code>  </p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.COLLECTION_NAME</span><span class="hljs-selector-class">.aggregate</span>(<span class="hljs-selector-tag">AGGREGATE_OPERATION</span>)<br></code></pre></div></td></tr></table></figure>
<table>
<thead>
<tr>
<th>表达式</th>
<th>描述</th>
<th>实例</th>
</tr>
</thead>
<tbody><tr>
<td>$sum</td>
<td>计算总和</td>
<td><code>db.mycol.aggregate([&#123;$group : &#123;_id : &quot;$by_user&quot;, num_tutorial : &#123;$sum : &quot;$likes&quot;&#125;&#125;&#125;])</code></td>
</tr>
<tr>
<td>$avg</td>
<td>计算平均值</td>
<td><code>   db.mycol.aggregate([&#123;$group : &#123;_id : &quot;$by_user&quot;, num_tutorial : &#123;$avg : &quot;$likes&quot;&#125;&#125;&#125;])</code></td>
</tr>
<tr>
<td>$min</td>
<td>获取集合中所有文档对应值得最小值</td>
<td><code>db.mycol.aggregate([&#123;$group : &#123;_id : &quot;$by_user&quot;, num_tutorial : &#123;$min : &quot;$likes&quot;&#125;&#125;&#125;])</code></td>
</tr>
<tr>
<td>$max</td>
<td>获取集合中所有文档对应值得最大值</td>
<td><code>db.mycol.aggregate([&#123;$group : &#123;_id : &quot;$by_user&quot;, num_tutorial : &#123;$max : &quot;$likes&quot;&#125;&#125;&#125;])</code></td>
</tr>
<tr>
<td>$push</td>
<td>在结果文档中插入值到一个数组中</td>
<td><code>db.mycol.aggregate([&#123;$group : &#123;_id : &quot;$by_user&quot;, url : &#123;$push: &quot;$url&quot;&#125;&#125;&#125;])</code></td>
</tr>
<tr>
<td>$addToSet</td>
<td>在结果文档中插入值到一个数组中，但不创建副本</td>
<td><code>db.mycol.aggregate([&#123;$group : &#123;_id : &quot;$by_user&quot;, url : &#123;$addToSet : &quot;$url&quot;&#125;&#125;&#125;])</code></td>
</tr>
<tr>
<td>$first</td>
<td>根据资源文档的排序获取第一个文档数据</td>
<td><code>db.mycol.aggregate([&#123;$group : &#123;_id : &quot;$by_user&quot;, first_url : &#123;$first : &quot;$url&quot;&#125;&#125;&#125;])</code></td>
</tr>
<tr>
<td>$last</td>
<td>根据资源文档的排序获取最后一个文档数据</td>
<td><code>db.mycol.aggregate([&#123;$group : &#123;_id : &quot;$by_user&quot;, last_url : &#123;$last : &quot;$url&quot;&#125;&#125;&#125;])</code></td>
</tr>
</tbody></table>
<blockquote>
<p>案例：计算每个作者所写的文章数  </p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css">&#123;<br>   <span class="hljs-attribute">_id</span>: <span class="hljs-built_in">ObjectId</span>(<span class="hljs-number">7</span>df78ad8902c)<br>   title: <span class="hljs-string">&#x27;MongoDB Overview&#x27;</span>, <br>   description: <span class="hljs-string">&#x27;MongoDB is no sql database&#x27;</span>,<br>   by_user: <span class="hljs-string">&#x27;runoob.com&#x27;</span>,<br>&#125;,<br>&#123;<br>   <span class="hljs-attribute">_id</span>: <span class="hljs-built_in">ObjectId</span>(<span class="hljs-number">7</span>df78ad8902d)<br>   title: <span class="hljs-string">&#x27;NoSQL Overview&#x27;</span>, <br>   description: <span class="hljs-string">&#x27;No sql database is very fast&#x27;</span>,<br>   by_user: <span class="hljs-string">&#x27;runoob.com&#x27;</span>,<br>&#125;,<br>&#123;<br>   <span class="hljs-attribute">_id</span>: <span class="hljs-built_in">ObjectId</span>(<span class="hljs-number">7</span>df78ad8902e)<br>   title: <span class="hljs-string">&#x27;Neo4j Overview&#x27;</span>, <br>   description: <span class="hljs-string">&#x27;Neo4j is no sql database&#x27;</span>,<br>   by_user: <span class="hljs-string">&#x27;Neo4j&#x27;</span>,<br>&#125;,<br></code></pre></div></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs groovy">db.mycol.aggregate([&#123;<span class="hljs-attr">$group :</span> &#123;<span class="hljs-attr">_id :</span> <span class="hljs-string">&quot;$by_user&quot;</span>, <span class="hljs-attr">num_tutorial :</span> &#123;<span class="hljs-attr">$sum :</span> <span class="hljs-number">1</span>&#125;&#125;&#125;])<br></code></pre></div></td></tr></table></figure>
<h3 id="管道的概念"><a href="#管道的概念" class="headerlink" title="管道的概念"></a>管道的概念</h3><p>管道在<code>Unix</code>和<code>Linux</code>中一般用于将当前命令的输出结果作为下一个命令的参数。  </p>
<p><code>MongoDB</code>的聚合管道将<code>MongoDB</code>文档在一个管道处理完毕后将结果传递给下一个管道处理。管道操作是可以重复的。  </p>
<blockquote>
<p>表达式：处理输入文档并输出。表达式是无状态的，只能用于计算当前聚合管道的文档，不能处理其它的文档。</p>
</blockquote>
<p>聚合框架中常用操作：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>信息</th>
</tr>
</thead>
<tbody><tr>
<td>$project</td>
<td>修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档</td>
</tr>
<tr>
<td>$match</td>
<td>用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作</td>
</tr>
<tr>
<td>$limit</td>
<td>用来限制MongoDB聚合管道返回的文档数</td>
</tr>
<tr>
<td>$skip</td>
<td>在聚合管道中跳过指定数量的文档，并返回余下的文档</td>
</tr>
<tr>
<td>$unwind</td>
<td>将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值</td>
</tr>
<tr>
<td>$group</td>
<td>将集合中的文档分组，可用于统计结果</td>
</tr>
<tr>
<td>$sort</td>
<td>将输入文档排序后输出</td>
</tr>
<tr>
<td>$geoNear</td>
<td>输出接近某一地理位置的有序文档</td>
</tr>
<tr>
<td>$lookup</td>
<td>多表关联</td>
</tr>
</tbody></table>
<blockquote>
<p>案例：结果中只有_id,tilte和author三个字段  </p>
</blockquote>
<figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.article</span><span class="hljs-selector-class">.aggregate</span>(<br>    &#123; $<span class="hljs-attribute">project </span>: &#123;<br>        <span class="hljs-attribute">title </span>: <span class="hljs-number">1</span> ,<br>        <span class="hljs-attribute">author </span>: <span class="hljs-number">1</span> ,<br>    &#125;&#125;<br> );<br></code></pre></div></td></tr></table></figure>
<p>实际上有还有一个默认添加的字段<code>_id</code>，如果想要取消指定<code>_id:0</code>即可  </p>
<h3 id="lookup多表查询"><a href="#lookup多表查询" class="headerlink" title="$lookup多表查询"></a><code>$lookup</code>多表查询</h3><p><strong>主要功能</strong><br>处理每个输入的文档，输出的新文档中会包含一个新生成的数组列（户名可根据需要命名新key的名字），如果没有内容适配，集合为空（即<code>[ ]</code>）</p>
<p><strong>语法</strong>  </p>
<figure class="highlight smali"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs smali">&#123;<br>   $lookup:<br>     &#123;<br>       from: &lt;collection to join&gt;,<br>       localField: &lt;field from the input documents&gt;,<br>       foreignField: &lt;field from the documents of the <span class="hljs-string">&quot;from&quot;</span> collection&gt;,<br>       as: &lt;output<span class="hljs-built_in"> array </span>field&gt;<br>     &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<table>
<thead>
<tr>
<th>语法值</th>
<th>解释说明</th>
</tr>
</thead>
<tbody><tr>
<td>from</td>
<td>同一个数据库中等待被 <code>Join</code> 的集合</td>
</tr>
<tr>
<td>localField</td>
<td>被<code>Join</code>集合中的 键<br>如果集合中的某个文档没有这个键，那么就认为其实这个文档有这个键，只是个键的值为 <code>null</code></td>
</tr>
<tr>
<td>foreignField</td>
<td>要<code>Join</code>的集合的 键<br>如果集合中的某个文档没有这个键，那么就认为其实这个文档有这个键，只是个键的值为 <code>None</code></td>
</tr>
<tr>
<td>as</td>
<td>为输出文档的新增键命名<br>如果输入的集合中已存在该值，则会覆盖掉</td>
</tr>
</tbody></table>
<blockquote>
<p>例: 查询武器的所有信息  </p>
</blockquote>
<figure class="highlight ada"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ada">集合 items<br>&#123; <span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-number">1</span>,  <span class="hljs-string">&quot;item&quot;</span>:<span class="hljs-string">&quot;大剑&quot;</span>,  <span class="hljs-string">&quot;price&quot;</span>:<span class="hljs-number">1200</span>, <span class="hljs-string">&quot;quality&quot;</span>:<span class="hljs-number">100</span> &#125;,<br>&#123; <span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-number">2</span>,  <span class="hljs-string">&quot;item&quot;</span>:<span class="hljs-string">&quot;弓箭&quot;</span>,  <span class="hljs-string">&quot;price&quot;</span>:<span class="hljs-number">800</span>,  <span class="hljs-string">&quot;quality&quot;</span>:<span class="hljs-number">80</span> &#125;,<br><br>集合 effect<br>&#123; <span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-number">1</span>,  <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;弓箭&quot;</span>,  <span class="hljs-string">&quot;attack&quot;</span>: <span class="hljs-number">90</span>,   <span class="hljs-string">&quot;scope&quot;</span> : 300 &#125;,<br>&#123; <span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-number">2</span>,  <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;大剑&quot;</span>,  <span class="hljs-string">&quot;attack&quot;</span>: <span class="hljs-number">200</span>,  <span class="hljs-string">&quot;scope&quot;</span> : 16 &#125;,<br>&#123; <span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-number">3</span>,  <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;大炮&quot;</span>,  <span class="hljs-string">&quot;attack&quot;</span>: <span class="hljs-number">360</span>,  <span class="hljs-string">&quot;scope&quot;</span> : 900 &#125;,<br></code></pre></div></td></tr></table></figure>
<p>进行聚合计算  </p>
<figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.aggregate</span>([<br>   &#123;<br>     $<span class="hljs-attribute">lookup</span>:<br>       &#123;<br>         <span class="hljs-attribute">from</span>: <span class="hljs-string">&quot;effect&quot;</span>,<br>         <span class="hljs-attribute">localField</span>: <span class="hljs-string">&quot;item&quot;</span>,<br>         <span class="hljs-attribute">foreignField</span>: <span class="hljs-string">&quot;name&quot;</span>,<br>         <span class="hljs-attribute">as</span>: <span class="hljs-string">&quot;item_info&quot;</span><br>       &#125;<br>  &#125;<br>])<br></code></pre></div></td></tr></table></figure>
<p>得到结果</p>
<figure class="highlight scheme"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs scheme">[<br>    &#123;<span class="hljs-symbol">&#x27;_id</span><span class="hljs-symbol">&#x27;:</span> <span class="hljs-number">1</span>, <span class="hljs-symbol">&#x27;item</span><span class="hljs-symbol">&#x27;:</span> <span class="hljs-symbol">&#x27;大剑</span>&#x27;, <span class="hljs-symbol">&#x27;price</span><span class="hljs-symbol">&#x27;:</span> <span class="hljs-number">1200</span>, <span class="hljs-symbol">&#x27;quality</span><span class="hljs-symbol">&#x27;:</span> <span class="hljs-number">100</span>, <span class="hljs-symbol">&#x27;item_info</span><span class="hljs-symbol">&#x27;:</span> []&#125;, <br>    &#123;<span class="hljs-symbol">&#x27;_id</span><span class="hljs-symbol">&#x27;:</span> <span class="hljs-number">2</span>, <span class="hljs-symbol">&#x27;item</span><span class="hljs-symbol">&#x27;:</span> <span class="hljs-symbol">&#x27;弓箭</span>&#x27;, <span class="hljs-symbol">&#x27;price</span><span class="hljs-symbol">&#x27;:</span> <span class="hljs-number">800</span>, <span class="hljs-symbol">&#x27;quality</span><span class="hljs-symbol">&#x27;:</span> <span class="hljs-number">80</span>, <span class="hljs-symbol">&#x27;item_info</span><span class="hljs-symbol">&#x27;:</span> []&#125;<br>]<br></code></pre></div></td></tr></table></figure>


<hr>
<p>未完成：<a target="_blank" rel="noopener" href="https://www.runoob.com/mongodb/mongodb-replication.html">https://www.runoob.com/mongodb/mongodb-replication.html</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/MongoDB/">MongoDB</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/post/f1278502/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Scrapy-基础-Shell</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/post/cdc32bf4/">
                        <span class="hidden-mobile">Charles-抓包</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        粤ICP备2020127796号
      </a>
    </span>
    
      
        <span>
          <a
            href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44010502001787"
            rel="nofollow noopener"
            class="beian-police"
            target="_blank"
          >
            
              <span style="visibility: hidden; width: 0">|</span>
              <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon"/>
            
            <span>粤公网安备 44010502001787号</span>
          </a>
        </span>
      
    
  </div>


  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?https://hm.baidu.com/hm.js?758d4ab1e944598b8ead03bb4eb143a5";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
